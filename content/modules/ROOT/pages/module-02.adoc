:imagesdir: ../assets/images
== Module 2: The Review Processor Agentic App

Objective: Implement and deploy the first AI agent, which is a Java-based, multi-step orchestration application running on Quarkus.


== User flow:

image:m2/review-processor-diagram.png[Review Processor Agent Diagram, width=600]

Here is an overview of the user flow:

* The reviews submitted by users via the front-end application are published to the `review-intake` Kafka topic.
* The Review Processor Agent consumes the events from the `review-intake` topic.
* The agent then uses LangGraph4j to *orchestrate a multi-step workflow* as shown in the diagram above: 
1. Moderate the review
2. Perform Sentiment Analysis using another LLM 
3. Fetch user data from an internal API
4. Generate a personalized thank-you email using an LLM 
5. Send the email via the MCP Mail Server (secured with OIDC/OAuth from Keycloak) 
6. Persist the moderated review and sentiment score to MongoDB._ 
* Finally, the processed review event is published to the `review-processed` Kafka topic for downstream which is the Review Summary Agent.


NOTE: LangGraph is a library for develop AI Agentic Architectures in the Java ecosystem and works seamlessly with both Langchain4j

NOTE: MCP (Model Context Protocol) is an open standard for AI to connect with external tools and data 


== Activity walk through:

. Login to the OpenShift cluster and navigate to the `review-processor` project/namespace.

Examine Review Processor Project: Review the Quarkus source code for the review-processor service.
Identify Kafka Consumer: Locate the code consuming messages from the review-intake Kafka topic.
Map LangGraph4j Workflow: Identify the implementation of the orchestration workflow. This workflow includes:
LLM Calls: For Moderation and Sentiment Analysis.
API Calls: To an internal back-end to Fetch User Data.
Email Generation: An LLM call to draft the personalized thank-you email.
Secure Communication: Using the MCP server (secured with OIDC/OAuth from Keycloak) to send the email.
Persistence: Writing the results to MongoDB.
Build and Deploy: Build the Quarkus application and deploy the review-processor containerized service to OpenShift.

== Technical Context:

This agent is implemented using Quarkus and leverages LangGraph4j for orchestrating a multi-step AI workflow. The use of Kafka as the event log allows the Review Processor to be decoupled from both the front-end application and the downstream Review Summary Agent, enhancing scalability and resilience. The integration with Keycloak for secure communication with the MCP Mail Server demonstrates best practices in securing AI workflows in enterprise environments.


.Example Code Snippet
[source,java]
----
include::path/to/your/file.java[tag=mySnippet]
----